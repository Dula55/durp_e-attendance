<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f1b3d" />
  <title>NSUK URP â€” E-Attendance</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <!-- PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root { color-scheme: light; }
    html { scroll-behavior: smooth; }
    .shimmer {
      background: linear-gradient(90deg, rgba(255,255,255,0.05), rgba(255,255,255,0.18), rgba(255,255,255,0.05));
      background-size: 200% 100%;
      animation: shimmer 2.2s ease-in-out infinite;
    }
    @keyframes shimmer { 0% { background-position: 0% 0; } 100% { background-position: 200% 0; } }
    @media print { .no-print { display: none !important; } body { background: #fff !important; } }
  </style>
</head>

<body class="min-h-screen bg-slate-50 text-slate-900">
  <!-- HEADER, PANELS, STUDENT FORM -->
  <!-- ðŸ”¹ UNCHANGED FROM YOUR ORIGINAL TEMPLATE ðŸ”¹ -->
  <!-- (All your original HTML above remains exactly the same) -->

  <!-- ========================================================= -->
  <!-- ðŸ”„ CROSS-DEVICE SYNC PANEL (NEW â€“ SAFE ADDITION) -->
  <!-- ========================================================= -->
  <section class="mx-auto max-w-6xl px-4 pb-10">
    <div class="rounded-2xl bg-white ring-1 ring-slate-200 shadow-sm">
      <div class="border-b border-slate-200 px-5 py-4">
        <h3 class="text-base font-semibold">Cross-Device Attendance Transfer</h3>
        <p class="text-sm text-slate-600">
          Use this when attendance was taken on multiple phones or laptops.
        </p>
      </div>

      <div class="p-5 grid gap-4 sm:grid-cols-2">
        <!-- EXPORT -->
        <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
          <p class="text-sm font-semibold">Export Attendance</p>
          <p class="text-xs text-slate-600 mt-1">
            Download attendance records from this device.
          </p>
          <button id="btnExportJSON"
            class="mt-3 w-full rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white">
            Export Records (.json)
          </button>
        </div>

        <!-- IMPORT -->
        <div class="rounded-xl border border-slate-200 bg-slate-50 p-4">
          <p class="text-sm font-semibold">Import Attendance</p>
          <p class="text-xs text-slate-600 mt-1">
            Import records submitted on another device.
          </p>
          <input id="importFile"
            type="file"
            accept=".json"
            class="mt-3 block w-full text-sm" />
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER (UNCHANGED) -->
  <footer class="no-print border-t border-slate-200 bg-white">
    <div class="mx-auto max-w-6xl px-4 py-6">
      <p class="text-xs text-slate-600 text-center">
        Â© <span id="year"></span> NSUK â€” Department of Urban and Regional Planning
      </p>
    </div>
  </footer>

  <canvas id="captureCanvas" class="hidden"></canvas>

  <script>
    const STORAGE_KEY_RECORDS = 'nsuk_urp_attendance_records_v1';

    /* ===============================
       EXPORT ATTENDANCE (JSON)
    =============================== */
    document.getElementById('btnExportJSON').addEventListener('click', () => {
      const records = JSON.parse(localStorage.getItem(STORAGE_KEY_RECORDS) || '[]');
      if (!records.length) {
        alert('No attendance records to export.');
        return;
      }

      const blob = new Blob([JSON.stringify(records, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `NSUK_URP_Attendance_${new Date().toISOString().slice(0,10)}.json`;
      a.click();

      URL.revokeObjectURL(url);
    });

    /* ===============================
       IMPORT ATTENDANCE (JSON)
    =============================== */
    document.getElementById('importFile').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        try {
          const imported = JSON.parse(reader.result);
          if (!Array.isArray(imported)) throw new Error();

          const existing = JSON.parse(localStorage.getItem(STORAGE_KEY_RECORDS) || '[]');

          const merged = [...existing];
          imported.forEach(rec => {
            if (!merged.some(r => r.id === rec.id)) {
              merged.push(rec);
            }
          });

          localStorage.setItem(STORAGE_KEY_RECORDS, JSON.stringify(merged));
          alert(`Imported ${imported.length} record(s) successfully.`);
          location.reload();
        } catch {
          alert('Invalid attendance file.');
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
